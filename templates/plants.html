{% extends "base.html" %}

{% block title %}Plants – Jardin de Devey{% endblock %}

{% block content %}
<h1 class="h3 mb-3">Plants du jardin</h1>

{# --- RECHERCHE / FILTRES EXISTANTS (inchangé) --- #}
<form class="row g-2 align-items-end mb-3" method="get">
  <div class="col-md-6">
    <label class="form-label small mb-1">Recherche</label>
    <input type="text" class="form-control" name="q"
           value="{{ search }}" placeholder="Nom, variété, code…">
  </div>

  <div class="col-md-3">
    <label class="form-label small mb-1">Zone</label>
    <select class="form-select" name="zone">
      <option value="">Toutes les zones</option>
      {% for z in zones %}
        <option value="{{ z }}" {% if z == zone_filter %}selected{% endif %}>
          {{ z }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3 d-flex gap-2">
    <button class="btn btn-primary mt-auto">Filtrer</button>
    <a href="{{ url_for('plants') }}" class="btn btn-outline mt-auto">Reset</a>
  </div>
</form>

{# --- LISTE DES PLANTS --- #}
{% if plants %}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
  {% for p in plants %}
  <div class="col">
    <a href="{{ url_for('plant_detail', plant_id=p['id']) }}"
       class="text-decoration-none text-reset">
      <div class="card shadow-soft h-100">
        <div class="card-body small d-flex flex-column">

          {# -------- EN-TÊTE -------- #}
          <div class="d-flex justify-content-between align-items-start mb-1">
            <div>
              <div class="fw-semibold">
                {{ p["common_name"] }}
                {% if p["variety_name"] %}
                  – {{ p["variety_name"] }}
                {% endif %}
              </div>
              {% if p["latin_name"] %}
                <div class="latin text-muted">
                  <em>{{ p["latin_name"] }}</em>
                </div>
              {% endif %}
            </div>

            <span class="badge bg-outline">{{ p["label"] or ("#" ~ p["id"]) }}</span>
          </div>

          {# -------- CAPSULES -------- #}
          <div class="mb-2">

            {# Zone #}
            {% if p["zone"] %}
              <span class="badge bg-tag me-1 mb-1">
                Zone&nbsp;{{ p["zone"] }}
              </span>
            {% else %}
              <span class="badge bg-tag me-1 mb-1">À placer</span>
            {% endif %}

            {# Strate (vient de species) #}
            {% if p["species_strata"] %}
              <span class="badge bg-tag me-1 mb-1">
                {{ p["species_strata"] }}
              </span>
            {% endif %}
          </div>

          {# -------- NOTES -------- #}
          {% if p["notes"] %}
            <p class="text-muted mb-0 text-clamp-2">
              {{ p["notes"] }}
            </p>
          {% else %}
            <p class="text-muted mb-0 fst-italic">—</p>
          {% endif %}

        </div>
      </div>
    </a>
  </div>
  {% endfor %}
</div>
{% else %}
<p class="text-muted fst-italic">Aucun plant enregistré.</p>
{% endif %}
{% endblock %}