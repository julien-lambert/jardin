{% extends "base.html" %}

{% block title %}Modifier un individu – Jardin de Devey{% endblock %}

{% block content %}
<div class="shadow-soft p-3 p-md-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h5 mb-0">Modifier un individu</h1>
    <a href="{{ url_for('plant_detail', plant_id=plant['id']) }}" class="btn btn-outline btn-sm">
      Annuler
    </a>
  </div>

  <p class="mb-3 text-muted">
    <strong>Espèce :</strong>
    {{ plant['common_name'] }}
    {% if plant['variety_name'] %}
      – ‘{{ plant['variety_name'] }}’
    {% endif %}
    {% if plant['latin_name'] %}
      <br><span class="latin">{{ plant['latin_name'] }}</span>
    {% endif %}
  </p>

  <form method="post" class="row g-3">

    <div class="col-md-6">
      <label for="label" class="form-label">Étiquette / Nom de l’individu</label>
      <input
        type="text"
        name="label"
        id="label"
        class="form-control"
        value="{{ plant['label'] or '' }}"
        placeholder="Ex. GOJ-001, Poirier nord, Noyer sud…"
      >
    </div>

    <div class="col-md-6">
      <label for="zone" class="form-label">Zone / secteur</label>
      <input
        type="text"
        name="zone"
        id="zone"
        class="form-control"
        value="{{ plant['zone'] or '' }}"
        placeholder="Ex. A1, verger haut, haie est..."
      >
    </div>

    <div class="col-md-4">
      <label for="lat" class="form-label">Latitude</label>
      <input
        type="text"
        name="lat"
        id="lat"
        class="form-control"
        value="{{ plant['lat'] if plant['lat'] is not none else '' }}"
        placeholder="45.348751"
      >
      <div class="form-text">
        Tu peux laisser vide si la position n’est pas encore relevée.
      </div>
    </div>

    <div class="col-md-4">
      <label for="lon" class="form-label">Longitude</label>
      <input
        type="text"
        name="lon"
        id="lon"
        class="form-control"
        value="{{ plant['lon'] if plant['lon'] is not none else '' }}"
        placeholder="4.073198"
      >
    </div>

    <div class="col-md-4">
      <label for="altitude" class="form-label">Altitude (m)</label>
      <input
        type="text"
        name="altitude"
        id="altitude"
        class="form-control"
        value="{{ plant['altitude'] if plant['altitude'] is not none else '' }}"
        placeholder="905"
      >
    </div>

    <div class="col-md-6">
      <label for="height_current" class="form-label">Hauteur actuelle (m)</label>
      <input
        type="text"
        name="height_current"
        id="height_current"
        class="form-control"
        value="{{ plant['height_current'] if plant['height_current'] is not none else '' }}"
        placeholder="0.35"
      >
    </div>

    <div class="col-md-6">
      <label for="status" class="form-label">Statut de l’individu</label>
      {% set st = plant['status'] or '' %}
      <select name="status" id="status" class="form-select">
        <option value=""></option>
        {% for val,label in [
          ('planifié','Planifié'),
          ('planté','Planté'),
          ('en pépinière','En pépinière'),
          ('malade','Malade'),
          ('mort','Mort'),
          ('à déplacer','À déplacer')
        ] %}
          <option value="{{ val }}" {% if st == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6">
      <label for="tags" class="form-label">Tags individu (séparés par des virgules)</label>
      <input
        type="text"
        name="tags"
        id="tags"
        class="form-control"
        value="{{ plant['tags'] or '' }}"
        placeholder="ex. haie,sec,expérimental…"
      >
    </div>

    <div class="col-md-6">
      <label for="micro_site" class="form-label">Micro-site</label>
      <input
        type="text"
        name="micro_site"
        id="micro_site"
        class="form-control"
        value="{{ plant['micro_site'] or '' }}"
        placeholder="bord de chemin, butte, cuvette, etc."
      >
    </div>

    <div class="col-md-6">
      <label for="exposure_local" class="form-label">Exposition locale</label>
      {% set ex = plant['exposure_local'] or '' %}
      <select name="exposure_local" id="exposure_local" class="form-select">
        <option value=""></option>
        {% for val,label in [
          ('soleil','Plein soleil'),
          ('mi-ombre','Mi-ombre'),
          ('ombre','Ombre'),
          ('ombre légère','Ombre légère')
        ] %}
          <option value="{{ val }}" {% if ex == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6">
      <label for="soil_local" class="form-label">Sol local</label>
      <input
        type="text"
        name="soil_local"
        id="soil_local"
        class="form-control"
        value="{{ plant['soil_local'] or '' }}"
        placeholder="argilo-limoneux, caillouteux, etc."
      >
    </div>

    <div class="col-md-6">
      <label for="acquisition_type" class="form-label">Type d’acquisition</label>
      {% set atype = plant['acquisition_type'] or '' %}
      <select name="acquisition_type" id="acquisition_type" class="form-select">
        <option value=""></option>
        {% for val,label in [
          ('achat','Achat'),
          ('don','Don'),
          ('échange','Échange'),
          ('semis','Semis'),
          ('bouture','Bouture'),
          ('greffe','Greffe'),
          ('repiquage','Repiquage / transplantation'),
          ('autre','Autre')
        ] %}
          <option value="{{ val }}" {% if atype == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6">
      <label for="acquisition_source" class="form-label">Source</label>
      <input
        type="text"
        name="acquisition_source"
        id="acquisition_source"
        class="form-control"
        value="{{ plant['acquisition_source'] or '' }}"
        placeholder="Ex. voisine du Nevet, pépinière X…"
      >
    </div>

    <div class="col-md-6">
      <label for="plantnet_obs_id" class="form-label">ID PlantNet (observation)</label>
      <input
        type="text"
        name="plantnet_obs_id"
        id="plantnet_obs_id"
        class="form-control"
        value="{{ plant['plantnet_obs_id'] or '' }}"
        placeholder="ex. 1027450889"
      >
    </div>

    <div class="col-md-6">
      <label for="image_local" class="form-label">Image locale (chemin relatif)</label>
      <input
        type="text"
        name="image_local"
        id="image_local"
        class="form-control"
        value="{{ plant['image_local'] or '' }}"
        placeholder="img/plants/goji_1.jpg"
      >
      <div class="form-text">
        Chemin relatif dans <code>static/</code>.
      </div>
    </div>

    <div class="col-12">
      <label for="notes" class="form-label">Notes d’observation</label>
      <textarea
        name="notes"
        id="notes"
        rows="3"
        class="form-control"
        placeholder="Remarques, vigueur, aspect du feuillage, etc."
      >{{ plant['notes'] or '' }}</textarea>
    </div>

    <div class="col-12">
      <label for="care_notes" class="form-label">Entretien / suivi prévu</label>
      <textarea
        name="care_notes"
        id="care_notes"
        rows="3"
        class="form-control"
        placeholder="Paillage conseillé, arrosage, protection hivernale, etc."
      >{{ plant['care_notes'] or '' }}</textarea>
    </div>

    <div class="col-12 d-flex justify-content-between align-items-center mt-2">
      <a href="{{ url_for('plant_detail', plant_id=plant['id']) }}" class="btn btn-outline">
        Annuler
      </a>
      <button type="submit" class="btn btn-primary">
        Enregistrer les modifications
      </button>
    </div>
  </form>
</div>
{% endblock %}