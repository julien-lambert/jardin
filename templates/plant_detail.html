{% extends "base.html" %}

{% block title %}Plant {{ plant["label"] or plant["id"] }} – Jardin de Devey{% endblock %}

{% block content %}

<div class="d-flex gap-2 mb-3">
  <a href="{{ url_for('plants') }}" class="btn btn-sm btn-outline">
    ← Retour aux plantes
  </a>

  <a href="{{ url_for('plant_edit', plant_id=plant['id']) }}"
     class="btn btn-sm btn-primary">
    Modifier cet individu
  </a>
</div>

{# ---------------------------------------------------------
   CAPSULE PRINCIPALE (même look que species_detail)
---------------------------------------------------------- #}

<div class="card shadow-soft mb-4">
  <div class="card-body">
    <div class="row g-3 align-items-start">

      {# --- Colonne image 4x3, même style que species_detail --- #}
      <div class="col-12 col-md-4">
        {% set img_src = None %}
        {% if plant["image_local"] %}
          {# image spécifique à l’individu, dans static/ #}
          {% set img_src = url_for('static', filename=plant["image_local"]) %}
        {% elif plant["variety_image_url"] %}
          {# sinon image du cultivar, si définie #}
          {% set img_src = plant["variety_image_url"] %}
        {% elif plant["species_image_url"] %}
          {# sinon image de l’espèce #}
          {% set img_src = plant["species_image_url"] %}
        {% endif %}

        {% if img_src %}
          <div class="ratio ratio-4x3 mb-2">
            <img src="{{ img_src }}"
                 alt="Illustration de {{ plant['common_name'] }}"
                 class="img-fluid rounded-3"
                 style="object-fit: cover;">
          </div>
        {% else %}
          <div class="ratio ratio-4x3 mb-2 bg-light rounded-3 d-flex align-items-center justify-content-center text-muted">
            <span class="small">Aucune image</span>
          </div>
        {% endif %}
      </div>

      {# --- Colonne texte : nom, taxonomie, tags, étiquette --- #}
      <div class="col-12 col-md-8">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div>
            <h1 class="h4 mb-1">
              {{ plant["common_name"] }}
              {% if plant["variety_name"] %} – {{ plant["variety_name"] }}{% endif %}
            </h1>
            {% if plant["species_latin_name"] %}
              <p class="latin mb-3">
                <em>{{ plant["species_latin_name"] }}</em>
              </p>
            {% endif %}
          </div>
          <span class="badge bg-outline fs-6">
            {{ plant["label"] or ("#" ~ plant["id"]) }}
          </span>
        </div>

        <div class="row small mb-3">
          <div class="col-sm-6">
            <dl class="row mb-0">
              <dt class="col-4">Famille</dt>
              <dd class="col-8">{{ plant["species_family"] or "—" }}</dd>

              <dt class="col-4">Genre</dt>
              <dd class="col-8">{{ plant["species_genus"] or "—" }}</dd>

              <dt class="col-4">Strate</dt>
              <dd class="col-8">{{ plant["species_strata"] or "—" }}</dd>

              <dt class="col-4">Cultivar</dt>
              <dd class="col-8">{{ plant["variety_name"] or "—" }}</dd>
            </dl>
          </div>

          <div class="col-sm-6">
            <div class="mb-1 fw-semibold">Tags (espèce / cultivar)</div>
            {% set tags = (plant["species_tags"] or "").split(",") %}
            {% if tags|selectattr('strip')|list %}
              <p class="mb-2">
                {% for t in tags %}
                  {% if t.strip() %}
                    <span class="badge bg-tag me-1 mb-1">{{ t.strip() }}</span>
                  {% endif %}
                {% endfor %}
              </p>
            {% else %}
              <p class="text-muted mb-2 small">Aucun tag renseigné.</p>
            {% endif %}
          </div>
        </div>

        {% if plant["species_notes"] %}
          <p class="small text-muted mb-0">
            {{ plant["species_notes"] }}
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{# ---------------------------------------------------------
   BLOC "Données de l’individu" (terrain, notes, etc.)
---------------------------------------------------------- #}

<h2 class="h6 mb-2">Données de l’individu</h2>

<div class="card shadow-soft">
  <div class="card-body small">
    <div class="row">
      <div class="col-md-6">
        <dl class="row mb-0">
          <dt class="col-5 col-sm-4">Zone</dt>
          <dd class="col-7 col-sm-8">{{ plant["zone"] or "—" }}</dd>

          <dt class="col-5 col-sm-4">Planté le</dt>
          <dd class="col-7 col-sm-8">{{ plant["planted_at"] or "—" }}</dd>

          <dt class="col-5 col-sm-4">Latitude</dt>
          <dd class="col-7 col-sm-8">
            {{ plant["lat"] if plant["lat"] is not none else "—" }}
          </dd>

          <dt class="col-5 col-sm-4">Longitude</dt>
          <dd class="col-7 col-sm-8">
            {{ plant["lon"] if plant["lon"] is not none else "—" }}
          </dd>
        </dl>
      </div>

      <div class="col-md-6">
        {% if plant["notes"] %}
          <h3 class="h6">Notes sur l’individu</h3>
          <p class="mb-0">{{ plant["notes"] }}</p>
        {% else %}
          <p class="text-muted mb-0">
            Aucune note spécifique sur cet individu.
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}